<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ImageKit Secure Upload</title>
<style>
  body { font-family: Arial; padding: 20px; }
  #dropZone {
    width: 100%; height: 150px; border: 2px dashed #ccc; display:flex; align-items:center; justify-content:center;
    margin-bottom: 10px; cursor: pointer; color: #666;
  }
  #dropZone.dragover { border-color: #333; color: #333; }
  #uploadStatus { margin-top: 10px; }
</style>
</head>
<body>

<h2>Drag & Drop / File Upload</h2>
<div id="dropZone">Drop files here or click to select</div>
<input type="file" id="fileInput" style="display:none" multiple>
<div id="uploadStatus"></div>

<script src="https://unpkg.com/imagekit-javascript/dist/imagekit.min.js"></script>
<script>
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const uploadStatus = document.getElementById('uploadStatus');

const imagekit = new ImageKit({
    publicKey: "public_xxxxxxx",  // Netlify envâ€™den gelen public key
    urlEndpoint: "https://ik.imagekit.io/your_imagekit_id",
    authenticationEndpoint: "/.netlify/functions/imagekit-auth"
});

// Drag & Drop events
dropZone.addEventListener('click', () => fileInput.click());
dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
dropZone.addEventListener('dragleave', e => { e.preventDefault(); dropZone.classList.remove('dragover'); });
dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('dragover');
    const files = e.dataTransfer.files;
    if (files.length > 0) handleFiles(files);
});

fileInput.addEventListener('change', () => {
    if (fileInput.files.length > 0) handleFiles(fileInput.files);
});

function handleFiles(files) {
    uploadStatus.innerHTML = '';
    Array.from(files).forEach(file => {
        const status = document.createElement('div');
        status.textContent = `Uploading ${file.name}...`;
        uploadStatus.appendChild(status);

        imagekit.upload({
            file: file,
            fileName: file.name || "default_name.jpg",
            extensions: [
                { name: "google-auto-tagging", maxTags: 5, minConfidence: 95 }
            ]
        }, function(error, result) {
            if(error){
                console.error("Upload error:", error);
                status.textContent = `Error uploading ${file.name}`;
                status.style.color = "red";
            } else {
                console.log("Upload success:", result);
                status.textContent = `Uploaded: ${file.name} | URL: ${result.url} | Tags: ${JSON.stringify(result.googleAutoTags)}`;
                status.style.color = "green";
            }
        });
    });
}
</script>

</body>
</html>