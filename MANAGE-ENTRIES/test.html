<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ImageKit Secure Upload</title>
<style>
  body { font-family: Arial; padding: 20px; }
  #dropZone {
    width: 100%; height: 150px; border: 2px dashed #ccc; display:flex; align-items:center; justify-content:center;
    margin-bottom: 10px; cursor: pointer; color: #666;
  }
  #dropZone.dragover { border-color: #333; color: #333; }
  .file-status { margin-top: 10px; }
  .progress-bar {
    width: 100%; background: #f0f0f0; border-radius: 4px; overflow: hidden; margin-top: 4px;
  }
  .progress-bar-inner {
    width: 0%; height: 10px; background: green;
  }
</style>
</head>
<body>

<h2>Drag & Drop / File Upload</h2>
<div id="dropZone">Drop files here or click to select</div>
<input type="file" id="fileInput" style="display:none" multiple>
<div id="uploadStatus"></div>

<script src="https://unpkg.com/imagekit-javascript/dist/imagekit.min.js"></script>
<script>
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const uploadStatus = document.getElementById('uploadStatus');

const imagekit = new ImageKit({
    publicKey: "public_xxxxxxx",
    urlEndpoint: "https://ik.imagekit.io/your_imagekit_id",
    authenticationEndpoint: "/.netlify/functions/imagekit-auth"
});

// Drag & Drop events
dropZone.addEventListener('click', () => fileInput.click());
dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
dropZone.addEventListener('dragleave', e => { e.preventDefault(); dropZone.classList.remove('dragover'); });
dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('dragover');
    const files = e.dataTransfer.files;
    if (files.length > 0) handleFiles(files);
});

fileInput.addEventListener('change', () => {
    if (fileInput.files.length > 0) handleFiles(fileInput.files);
});

function handleFiles(files) {
    uploadStatus.innerHTML = '';
    Array.from(files).forEach(file => {
        const statusDiv = document.createElement('div');
        statusDiv.className = 'file-status';
        statusDiv.textContent = `Uploading ${file.name}...`;
        const progressBar = document.createElement('div');
        progressBar.className = 'progress-bar';
        const progressInner = document.createElement('div');
        progressInner.className = 'progress-bar-inner';
        progressBar.appendChild(progressInner);
        statusDiv.appendChild(progressBar);
        uploadStatus.appendChild(statusDiv);

        imagekit.upload({
            file: file,
            fileName: file.name || "default_name.jpg",
            extensions: [
                { name: "google-auto-tagging", maxTags: 5, minConfidence: 95 }
            ]
        }, function(error, result) {
            if(error){
                console.error("Upload error:", error);
                statusDiv.textContent = `Error uploading ${file.name}`;
                statusDiv.style.color = "red";
            } else {
                console.log("Upload success:", result);
                statusDiv.textContent = `Uploaded: ${file.name} | URL: ${result.url} | Tags: ${JSON.stringify(result.googleAutoTags)}`;
                statusDiv.style.color = "green";
            }
        }).on("progress", e => {
            const percent = Math.round((e.loaded / e.total) * 100);
            progressInner.style.width = percent + "%";
        });
    });
}
</script>

</body>
</html>