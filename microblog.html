<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tüm Entry'ler - Adem Bayazıt</title>
    <link rel="icon" type="image/png" href="/IMAGES/ab.png">
    <link rel="stylesheet" href="/CSS/style.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.0/css/flag-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Özel stiller */
        .microblog-container {
            width: 100%;
            padding: 60px 10%;
            background: transparent;
            margin-top: 80px;
        }
        
        .entries-container {
            background: black;
            border: 2px solid limegreen;
            border-radius: 20px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.1);
        }
        
        .load-more-container {
            text-align: center;
            margin-top: 20px;
        }
        
        .load-more-btn {
            background: limegreen;
            color: black;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .load-more-btn:hover {
            background: #00cc00;
            box-shadow: 0 0 10px limegreen;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
            color: limegreen;
        }
        
        .back-to-home {
            display: inline-block;
            margin-bottom: 15px;
            padding:5px
            color: limegreen;
            text-decoration: none;
            font-weight: bold;
        }
        
        .back-to-home:hover {
            text-decoration: underline;
        }
        
        .entry-count {
            color: #90ee90;
            margin-bottom: 15px;
            font-style: italic;
        }
        
        /* Dropdown stilleri */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropbtn {
            font-size: 18px;
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            margin-left: 10px;
            cursor: pointer;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: green;
            min-width: 160px;
            z-index: 100;
            border: 1px solid white;
            border-radius: 10px;
        }

        .dropdown-content a {
            color: white;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .dropdown-content a:hover {
            color: white;
            background-color: limegreen;
            text-shadow: 0 0 10px green;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }
    </style>
</head>
<body>
    <header class="header">
        <a href="/" class="logo"><img src="IMAGES/hackerwhite.svg" alt="Hacker Icon" class="hackerwhite-icon">{adembayazit} </a>
        <nav class="navbar">
            <div class="dropdown">
                <a href="#" style="--i:5;" class="dropbtn"> <img src="IMAGES/Ata.svg" alt="Ata Icon" class="ata-icon"><span class="fi fi-tr"></span> <span class='bx bx-code-alt'></span> Ethical Hacker <span class='bx bx-chevron-down'></span></a>
                <div class="dropdown-content">
                    <a href="#tools"><img src="IMAGES/hackerwhite.svg" alt="Hacker Icon" class="hacker-icon"> What is an Ethical Hacker?</a>
                    <a href="#reports"><img src="IMAGES/glossary.svg" alt="Glossary" class="glossary-icon"> Cybersecurity Glossary</a>
                    <a href="#payloads"><img src="IMAGES/soc.svg" alt="Soc" class="soc-icon"> What is a SOC ?</a>
                    <a href="#payloads"><img src="IMAGES/vulnerabilities.svg" alt="Vulnerabilities" class="vulnerabilities-icon"> Vulnerabilities</a>
                    <a href="#payloads"><img src="IMAGES/steganography.svg" alt="Steganography" class="steganography-icon"> Steganography</a>
                    <a href="#payloads"><img src="IMAGES/cryptography.svg" alt="Cryptography" class="cryptography-icon"> Cryptography</a>    
                    <a href="#payloads"><img src="IMAGES/education.svg" alt="Education" class="education-icon"> Cybersecurity Learning Resources</a>
                </div>
            </div>
        </nav>
    </header>

    <section class="microblog-container">
        <a href="/" class="back-to-home"><i class='bx bx-arrow-back'></i> Back to Home</a>
        <h2 class="section-title"><i class="fa-solid fa-pager"></i> All LadyB<span class="fa-solid fa-bug bug-icon"></span>G Entries</h2>
        <div class="entry-count" id="entryCount">Total 0 Entry</div>
        <div id="entries" class="entries-container"></div>
        <div class="loading" id="loading">Loading...</div>
        <div class="load-more-container">
            <button id="loadMoreBtn" class="load-more-btn">More (20)</button>
        </div>
    </section>

    <footer style="text-align: center; padding: 20px; font-size: 14px; color: white; margin-top: 50px;">
        <hr style="margin-bottom: 10px; border-color: limegreen;" />
        <p>Design & Code by <strong>Adem Bayazıt</strong> | Version 1.3.2 | July 2025</p>
    </footer>

    <script>
        // 1. GLOBAL DEĞİŞKENLER
        const likesCache = {
          data: {},
          lastUpdated: 0,
          isUpdating: false
        };

        const pinsCache = {
          data: {},
          lastUpdated: 0,
          isUpdating: false
        };

        let allEntries = [];
        let displayedEntries = 0;
        const entriesPerPage = 20;

        // 2. PROXY HELPER FONKSİYONU
        async function fetchViaProxy(path, method = 'GET', body = null) {
          const proxyUrl = 'https://adembayazit.netlify.app/.netlify/functions/jsonbin-proxy';
          
          try {
            const response = await fetch(proxyUrl, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ path, method, body })
            });

            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            return await response.json();
          } catch (error) {
            console.error('Proxy error:', error);
            throw error;
          }
        }

        // 3. TEMEL FONKSİYONLAR
        async function loadInteractions() {
          try {
            const result = await fetchViaProxy('/b/68862fd97b4b8670d8a81945/latest');
            likesCache.data = result.likes || {};
            pinsCache.data = result.pins || {};
            likesCache.lastUpdated = pinsCache.lastUpdated = Date.now();
          } catch (error) {
            console.error('loadInteractions error:', error);
            try {
              const localLikes = localStorage.getItem('entryLikes') || '{}';
              const localPins = localStorage.getItem('entryPins') || '{}';
              likesCache.data = JSON.parse(localLikes);
              pinsCache.data = JSON.parse(localPins);
            } catch (parseError) {
              console.Error('Local storage parse error:', parseError);
            }
          }
        }

        // HTML içeriğini düzgün işlemek için yardımcı fonksiyon
        function formatContent(content) {
          // <br> etiketlerini doğru şekilde işle
          content = content.replace(/<br\s*\/?>/gi, '<br>');
          
          // <p></p> boş paragrafları kaldır (isteğe bağlı)
          content = content.replace(/<p>\s*<\/p>/gi, '');
          
          return content;
        }

        // ÇEVİRİ İKONLARINI EKLEME FONKSİYONU
        async function addTranslationIcons() {
          const entries = document.querySelectorAll(".entry");
          if (entries.length === 0) return;

          entries.forEach(entry => {
            const idDiv = entry.querySelector(".entry-id");
            const contentDiv = entry.querySelector(".content");
            const originalContent = contentDiv?.innerHTML?.trim();
            if (!idDiv || !originalContent) return;
            
            if (idDiv.querySelector(".translation-icon")) return;

            const idValue = parseInt(idDiv.textContent.replace(/\D/g, ''));
            if (isNaN(idValue)) return;

            const translationEntry = allEntries.find(item => item.id === idValue);
            
            if (!translationEntry?.content_tr) return;

            const icon = document.createElement("span");
            icon.classList.add("translation-icon", "fi", "fi-tr");
            icon.title = "Çeviriyi göster/gizle";
            
            const langCode = translationEntry?.lang || 'tr';
            icon.classList.add(`fi-${langCode}`);

            icon.addEventListener("click", (e) => {
              e.stopPropagation();
              icon.classList.toggle("active");
              
              if (icon.classList.contains("active")) {
                if (translationEntry.content_tr) {
                  // HTML içeriğini düzgün şekilde işle
                  contentDiv.innerHTML = formatContent(translationEntry.content_tr);
                }
              } else {
                contentDiv.innerHTML = originalContent;
              }
            });

            document.addEventListener("click", (e) => {
              if (!icon.contains(e.target) && !contentDiv.contains(e.target)) {
                icon.classList.remove("active");
                contentDiv.innerHTML = originalContent;
              }
            });

            idDiv.appendChild(icon);
          });
        }

        function createEntryElement(entry, depth = 0) {
          const entryDiv = document.createElement("div");
          entryDiv.className = `entry ${depth > 0 ? 'child-entry' : ''}`;
          
          if (depth > 0) {
            entryDiv.style.marginLeft = (depth * 30) + 'px';
          }

          const time = new Date(entry.date).toLocaleString("tr-TR", {
            year: "numeric", 
            month: "2-digit", 
            day: "2-digit", 
            hour: "2-digit", 
            minute: "2-digit"
          }).replace(",", "");

          const likeCount = likesCache.data[entry.id] || 0;
          const pinCount = pinsCache.data[entry.id] || 0;

          // HTML içeriğini formatla
          const formattedContent = formatContent(entry.content);

          entryDiv.innerHTML = `
            <div class="timestamp">
              <span class="fa-solid fa-bug bug-iconentry"></span> ${time}
            </div>
            <div class="entry-id">#${entry.id}</div>
            <div class="content">${formattedContent}</div>
            <div class="interaction-buttons">
              <div class="daisy-like" data-entry-id="${entry.id}">
                <img src="/IMAGES/daisy.svg" class="daisy-icon" alt="Beğen" />
                <span class="like-count">${likeCount}</span>
              </div>
              <div class="pine-pin" data-entry-id="${entry.id}">
                <img src="/IMAGES/pine.svg" class="pine-icon" alt="Pinle" />
                <span class="pin-count">${pinCount}</span>
              </div>
            </div>
          `;

          const likeIcon = entryDiv.querySelector(".daisy-icon");
          likeIcon?.addEventListener("click", () => handleLikeClick(entry.id, entryDiv));

          const pinIcon = entryDiv.querySelector(".pine-icon");
          pinIcon?.addEventListener("click", () => handlePinClick(entry.id, entryDiv));

          return entryDiv;
        }

        function displayEntries(startIndex, count) {
          const container = document.getElementById("entries");
          const loadingElement = document.getElementById("loading");
          const loadMoreBtn = document.getElementById("loadMoreBtn");
          
          if (startIndex >= allEntries.length) {
            loadMoreBtn.style.display = 'none';
            return;
          }
          
          loadingElement.style.display = 'block';
          
          // Yeni entry'leri ekle
          const endIndex = Math.min(startIndex + count, allEntries.length);
          for (let i = startIndex; i < endIndex; i++) {
            const entryElement = createEntryElement(allEntries[i], 0);
            container.appendChild(entryElement);
            
            // Bu entry'nin alt entry'lerini bul ve ekle
            const childEntries = allEntries.filter(e => 
              e.references && e.references.includes(allEntries[i].id)
            );
            
            childEntries.forEach(childEntry => {
              const childElement = createEntryElement(childEntry, 1);
              container.appendChild(childElement);
            });
          }
          
          displayedEntries = endIndex;
          document.getElementById('entryCount').textContent = `Total ${displayedEntries} entry showing (Total ${allEntries.length} entry)`;
          
          // Çeviri ikonlarını ekle
          addTranslationIcons();
          
          loadingElement.style.display = 'none';
          
          // Tüm entry'ler gösterildiyse butonu gizle
          if (displayedEntries >= allEntries.length) {
            loadMoreBtn.style.display = 'none';
          }
        }

        // 4. INTERACTION FONKSİYONLARI
        async function handleLikeClick(entryId, entryDiv) {
          if (likesCache.isUpdating) return;

          likesCache.isUpdating = true;
          const likeCountSpan = entryDiv.querySelector(".like-count");
          const likeIcon = entryDiv.querySelector(".daisy-icon");
          const currentCount = parseInt(likeCountSpan.textContent) || 0;

          try {
            likeCountSpan.textContent = currentCount + 1;
            likeIcon.style.transform = 'scale(1.2)';
            
            likesCache.data[entryId] = currentCount + 1;
            localStorage.setItem('entryLikes', JSON.stringify(likesCache.data));
            
            await updateInteractionsOnServer(entryId, currentCount + 1, null);
            likesCache.lastUpdated = Date.now();
          } catch (error) {
            console.error('Like update failed:', error);
            likeCountSpan.textContent = currentCount;
            likesCache.data[entryId] = currentCount;
          } finally {
            likesCache.isUpdating = false;
            setTimeout(() => {
              likeIcon.style.transform = 'scale(1)';
            }, 300);
          }
        }

        async function handlePinClick(entryId, entryDiv) {
          if (pinsCache.isUpdating) return;

          pinsCache.isUpdating = true;
          const pinCountSpan = entryDiv.querySelector(".pin-count");
          const pinIcon = entryDiv.querySelector(".pine-icon");
          const currentCount = parseInt(pinCountSpan.textContent) || 0;

          try {
            pinCountSpan.textContent = currentCount + 1;
            pinIcon.classList.add("pinned");
            
            pinsCache.data[entryId] = currentCount + 1;
            localStorage.setItem('entryPins', JSON.stringify(pinsCache.data));
            
            await updateInteractionsOnServer(entryId, null, currentCount + 1);
            pinsCache.lastUpdated = Date.now();
          } catch (error) {
            console.error('Pin update failed:', error);
            pinCountSpan.textContent = currentCount;
            pinsCache.data[entryId] = currentCount;
          } finally {
            pinsCache.isUpdating = false;
            setTimeout(() => {
              pinIcon.classList.remove("pinned");
            }, 600);
          }
        }

        async function updateInteractionsOnServer(entryId, newLikeCount, newPinCount) {
          const updatedLikes = newLikeCount !== null ? { ...likesCache.data, [entryId]: newLikeCount } : likesCache.data;
          const updatedPins = newPinCount !== null ? { ...pinsCache.data, [entryId]: newPinCount } : pinsCache.data;

          try {
            await fetchViaProxy('/b/68862fd97b4b8670d8a81945', 'PUT', {
              likes: updatedLikes,
              pins: updatedPins
            });
          } catch (error) {
            throw new Error('Failed to update data on server');
          }
        }

        // 5. BAŞLANGIÇ FONKSİYONU
        async function initializeApp() {
          try {
            await loadInteractions();
            const entriesData = await fetchViaProxy('/b/68933248ae596e708fc2fbbc/latest');
            allEntries = entriesData.records || entriesData;
            
            // Entry'leri tarihe göre sırala (yeniden eskiye)
            allEntries.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // İlk 20 entry'yi göster
            displayEntries(0, entriesPerPage);
            
            // Daha fazla yükle butonuna event listener ekle
            document.getElementById('loadMoreBtn').addEventListener('click', () => {
              displayEntries(displayedEntries, entriesPerPage);
            });
          } catch (error) {
            console.error("Initialization error:", error);
            try {
              const response = await fetch("entries.json");
              const entriesData = await response.json();
              allEntries = entriesData.records || entriesData;
              allEntries.sort((a, b) => new Date(b.date) - new Date(a.date));
              displayEntries(0, entriesPerPage);
              
              document.getElementById('loadMoreBtn').addEventListener('click', () => {
                displayEntries(displayedEntries, entriesPerPage);
              });
            } catch (fallbackError) {
              console.error("Fallback failed:", fallbackError);
              document.getElementById("entries").innerHTML = 
                '<div class="error">Veriler yüklenirken bir hata oluştu</div>';
            }
          }
        }

        // 6. UYGULAMAYI BAŞLAT
        document.addEventListener("DOMContentLoaded", initializeApp);
    </script>
</body>
</html>